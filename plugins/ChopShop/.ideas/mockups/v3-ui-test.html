<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ChopShop UI Mockup v3 - Industrial Decay</title>

  <style>
    /* CRITICAL: WebView constraints */
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
    }

    *, *::before, *::after {
      box-sizing: border-box;
    }

    body {
      /* Native application feel */
      user-select: none;
      -webkit-user-select: none;
      cursor: default;
      overflow: hidden;

      /* Test frame centering */
      display: flex;
      align-items: center;
      justify-content: center;
      background: #000;
      font-family: 'Helvetica Neue', Arial, sans-serif;
    }

    /* Fixed-size preview frame matching plugin spec */
    .plugin-frame {
      width: 650px;
      height: 350px;
      border: 2px solid #666;
      box-shadow: 0 10px 40px rgba(0,0,0,0.8);
      overflow: hidden;
      position: relative;
    }

    /* Plugin UI container */
    .container {
      width: 100%;
      height: 100%;
      position: relative;
      background: linear-gradient(135deg, #5c5c5c 0%, #4a4a4a 50%, #3d3d3d 100%);
    }

    /* Rust stain patches (elliptical radial gradients) */
    .rust-stain-1 {
      position: absolute;
      left: 20%;
      top: 30%;
      width: 80px;
      height: 60px;
      background: radial-gradient(ellipse 80px 60px at center, rgba(139, 69, 19, 0.3) 0%, transparent 70%);
      pointer-events: none;
      z-index: 1;
    }

    .rust-stain-2 {
      position: absolute;
      left: 75%;
      top: 60%;
      width: 100px;
      height: 80px;
      background: radial-gradient(ellipse 100px 80px at center, rgba(160, 82, 45, 0.25) 0%, transparent 70%);
      pointer-events: none;
      z-index: 1;
    }

    .rust-stain-3 {
      position: absolute;
      left: 50%;
      top: 80%;
      width: 60px;
      height: 40px;
      background: radial-gradient(ellipse 60px 40px at center, rgba(139, 69, 19, 0.2) 0%, transparent 70%);
      pointer-events: none;
      z-index: 1;
    }

    /* Metal noise texture overlay */
    .background-texture {
      position: absolute;
      inset: 0;
      background-image:
        repeating-linear-gradient(
          0deg,
          transparent,
          transparent 2px,
          rgba(0, 0, 0, 0.03) 2px,
          rgba(0, 0, 0, 0.03) 4px
        ),
        repeating-linear-gradient(
          90deg,
          transparent,
          transparent 2px,
          rgba(0, 0, 0, 0.03) 2px,
          rgba(0, 0, 0, 0.03) 4px
        );
      opacity: 0.15;
      pointer-events: none;
      z-index: 2;
    }

    /* Title - industrial stencil */
    .title {
      position: absolute;
      left: 25px;
      top: 15px;
      font-family: 'Courier New', monospace;
      font-size: 20px;
      font-weight: bold;
      color: #d0d0d0;
      letter-spacing: 3px;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
      z-index: 10;
    }

    /* ===== MODULAR PATCH BAY SECTION ===== */
    .patch-bay {
      position: absolute;
      left: 15px;
      top: 50px;
      width: 620px;
      height: 80px;
      z-index: 5;
    }

    /* Global I/O Neutrik jacks */
    .global-jack {
      position: absolute;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 5px;
    }

    .jack-label {
      font-size: 9px;
      color: #e8e8e8;
      font-weight: bold;
      letter-spacing: 1px;
    }

    /* Neutrik jack backing plate (red) */
    .jack-backing {
      position: relative;
      width: 32px;
      height: 32px;
      background: linear-gradient(135deg, #8b0000, #a52a2a);
      border-radius: 3px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.6);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    /* Neutrik hexagon housing (black) */
    .jack-housing {
      width: 24px;
      height: 24px;
      background: conic-gradient(
        from 30deg,
        #2d2d2d 0deg 60deg,
        #1a1a1a 60deg 120deg,
        #2d2d2d 120deg 180deg,
        #1a1a1a 180deg 240deg,
        #2d2d2d 240deg 300deg,
        #1a1a1a 300deg 360deg
      );
      clip-path: polygon(25% 0%, 75% 0%, 100% 50%, 75% 100%, 25% 100%, 0% 50%);
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: inset 0 2px 4px rgba(0,0,0,0.8);
    }

    /* Gold center contact */
    .jack-contact {
      width: 6px;
      height: 6px;
      background: radial-gradient(circle, #ffd700 30%, #d4af37 70%);
      border-radius: 50%;
      box-shadow: 0 0 4px rgba(212, 175, 55, 0.8);
    }

    /* Effect modules */
    .effect-module {
      position: absolute;
      background: linear-gradient(135deg, #5c5c5c, #4a4a4a);
      border: 2px solid #1a1a1a;
      border-radius: 3px;
      box-shadow:
        0 4px 8px rgba(0,0,0,0.6),
        inset 0 1px 0 rgba(255,255,255,0.1);
    }

    .module-label {
      position: absolute;
      top: 3px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 9px;
      color: #e8e8e8;
      font-weight: bold;
      letter-spacing: 0.5px;
    }

    /* Module mini knobs (Shadow Hills style, 24px) */
    .mini-knob-container {
      position: absolute;
      top: 18px;
      left: 35px;
      width: 24px;
      height: 24px;
    }

    .mini-knob {
      width: 100%;
      height: 100%;
      border-radius: 50%;
      background: radial-gradient(circle at 30% 30%, #3d3d3d 0%, #1a1a1a 40%, #0d0d0d 100%);
      box-shadow:
        inset 2px 2px 6px rgba(255,255,255,0.15),
        inset -2px -2px 6px rgba(0,0,0,0.8),
        0 3px 8px rgba(0,0,0,0.8);
      position: relative;
      transform-origin: center center;
      transition: transform 50ms;
      cursor: pointer;
    }

    .mini-knob::before {
      content: '';
      position: absolute;
      top: 3px;
      left: 50%;
      transform: translateX(-50%);
      width: 2px;
      height: 6px;
      background: linear-gradient(180deg, #ffffff, #e0e0e0);
      border-radius: 1px;
      box-shadow: 0 0 2px rgba(255,255,255,0.5);
    }

    /* Module jacks (smaller 8px jacks) */
    .module-jack {
      position: absolute;
      width: 8px;
      height: 8px;
      top: 30px;
      background: radial-gradient(circle, #d4af37, #b8941f);
      border-radius: 50%;
      box-shadow: 0 0 3px rgba(212, 175, 55, 0.6);
    }

    .module-jack.input {
      left: 10px;
    }

    .module-jack.output {
      left: 80px;
    }

    /* ===== CENTER HERO KNOB (Shadow Hills style, 120px) ===== */
    .hero-knob-container {
      position: absolute;
      left: 265px;
      top: 155px;
      width: 120px;
      height: 120px;
      z-index: 8;
    }

    .hero-knob {
      width: 100%;
      height: 100%;
      border-radius: 50%;
      background: radial-gradient(circle at 30% 30%, #3d3d3d 0%, #1a1a1a 40%, #0d0d0d 100%);
      box-shadow:
        inset 3px 3px 12px rgba(255,255,255,0.15),
        inset -3px -3px 12px rgba(0,0,0,0.8),
        0 6px 16px rgba(0,0,0,0.8);
      position: relative;
      transform-origin: center center;
      transition: transform 50ms;
      cursor: pointer;
    }

    /* White pointer indicator */
    .hero-knob::before {
      content: '';
      position: absolute;
      top: 10px;
      left: 50%;
      transform: translateX(-50%);
      width: 4px;
      height: 30px;
      background: linear-gradient(180deg, #ffffff, #e0e0e0);
      border-radius: 2px;
      box-shadow: 0 0 4px rgba(255,255,255,0.5);
    }

    /* Scale markings around hero knob */
    .knob-scale {
      position: absolute;
      inset: -15px;
      pointer-events: none;
    }

    .scale-mark {
      position: absolute;
      top: 50%;
      left: 50%;
      width: 2px;
      height: 8px;
      background: #e8e8e8;
      transform-origin: center center;
    }

    .scale-text {
      position: absolute;
      top: 50%;
      left: 50%;
      font-size: 10px;
      color: #e8e8e8;
      font-weight: bold;
      transform-origin: center center;
    }

    .hero-label {
      position: absolute;
      top: 130px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 12px;
      color: #e8e8e8;
      font-weight: bold;
      letter-spacing: 1px;
      white-space: nowrap;
    }

    /* ===== BOTTOM CONTROLS ===== */

    /* Link toggle (industrial switch) */
    .link-toggle {
      position: absolute;
      left: 30px;
      top: 285px;
      width: 50px;
      height: 30px;
      background: #3d3d3d;
      border: 2px solid #1a1a1a;
      border-radius: 15px;
      cursor: pointer;
      display: flex;
      align-items: center;
      padding: 3px;
      transition: background 150ms;
      box-shadow: inset 0 2px 4px rgba(0,0,0,0.6);
      z-index: 8;
    }

    .link-toggle.active {
      background: linear-gradient(135deg, #228b22, #32cd32);
      box-shadow:
        inset 0 2px 4px rgba(0,0,0,0.4),
        0 0 12px rgba(0, 255, 0, 0.5);
    }

    .toggle-handle {
      width: 22px;
      height: 22px;
      background: linear-gradient(135deg, #2d2d2d, #1a1a1a);
      border-radius: 50%;
      box-shadow: 0 2px 6px rgba(0,0,0,0.8);
      transition: transform 150ms;
    }

    .link-toggle.active .toggle-handle {
      transform: translateX(20px);
    }

    .link-label {
      position: absolute;
      left: 30px;
      top: 320px;
      font-size: 10px;
      color: #e8e8e8;
      font-weight: bold;
      letter-spacing: 0.5px;
    }

    /* Trigger mode selector */
    .trigger-selector {
      position: absolute;
      left: 100px;
      top: 280px;
      width: 130px;
      height: 35px;
      background: #3d3d3d;
      border: 2px solid #1a1a1a;
      border-radius: 3px;
      color: #e8e8e8;
      font-size: 12px;
      font-weight: bold;
      padding: 0 10px;
      cursor: pointer;
      box-shadow: inset 0 2px 4px rgba(0,0,0,0.6);
      display: flex;
      align-items: center;
      justify-content: space-between;
      z-index: 8;
    }

    .trigger-selector::after {
      content: '▼';
      color: #ff4444;
      font-size: 10px;
    }

    .trigger-label {
      position: absolute;
      left: 100px;
      top: 320px;
      font-size: 10px;
      color: #e8e8e8;
      font-weight: bold;
      letter-spacing: 0.5px;
    }

    /* Small Shadow Hills knobs (70px) */
    .small-knob-container {
      position: absolute;
      width: 70px;
      height: 70px;
      z-index: 8;
    }

    .small-knob {
      width: 100%;
      height: 100%;
      border-radius: 50%;
      background: radial-gradient(circle at 30% 30%, #3d3d3d 0%, #1a1a1a 40%, #0d0d0d 100%);
      box-shadow:
        inset 2px 2px 8px rgba(255,255,255,0.15),
        inset -2px -2px 8px rgba(0,0,0,0.8),
        0 4px 12px rgba(0,0,0,0.8);
      position: relative;
      transform-origin: center center;
      transition: transform 50ms;
      cursor: pointer;
    }

    .small-knob::before {
      content: '';
      position: absolute;
      top: 8px;
      left: 50%;
      transform: translateX(-50%);
      width: 3px;
      height: 18px;
      background: linear-gradient(180deg, #ffffff, #e0e0e0);
      border-radius: 1.5px;
      box-shadow: 0 0 3px rgba(255,255,255,0.5);
    }

    .small-label {
      position: absolute;
      top: 80px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 10px;
      color: #e8e8e8;
      font-weight: bold;
      letter-spacing: 0.5px;
      white-space: nowrap;
    }

    /* ===== MODULAR CABLES (SVG) ===== */
    #cables-svg {
      position: absolute;
      inset: 0;
      pointer-events: none;
      z-index: 4;
    }

    .cable {
      stroke-width: 3;
      stroke-linecap: round;
      fill: none;
      opacity: 0.85;
      filter: drop-shadow(0 2px 4px rgba(0,0,0,0.6));
    }

    /* ===== DEBUG MONITOR ===== */
    .debug-monitor {
      position: fixed;
      bottom: 10px;
      right: 10px;
      background: rgba(0, 0, 0, 0.85);
      color: #0f0;
      font-family: 'Courier New', monospace;
      font-size: 11px;
      padding: 8px 12px;
      border: 1px solid #333;
      border-radius: 4px;
      min-width: 150px;
      pointer-events: none;
      z-index: 10000;
    }

    .debug-label {
      color: #666;
      font-size: 9px;
      margin-bottom: 4px;
      letter-spacing: 1px;
    }

    .debug-param {
      font-weight: bold;
      color: #0f0;
    }

    .debug-value {
      color: #fff;
      margin-top: 2px;
    }

    .debug-normalized {
      color: #888;
      font-size: 10px;
    }
  </style>
</head>
<body>
  <div class="plugin-frame">
    <div class="container">
      <!-- Rust stain patches -->
      <div class="rust-stain-1"></div>
      <div class="rust-stain-2"></div>
      <div class="rust-stain-3"></div>

      <!-- Metal texture overlay -->
      <div class="background-texture"></div>

      <!-- Title -->
      <div class="title">CHOPSHOP</div>

      <!-- Modular Patch Bay Section -->
      <div class="patch-bay">
        <!-- Global IN jack -->
        <div class="global-jack" style="left: 30px; top: 30px;">
          <div class="jack-label">IN</div>
          <div class="jack-backing">
            <div class="jack-housing">
              <div class="jack-contact"></div>
            </div>
          </div>
        </div>

        <!-- STUTTER module -->
        <div class="effect-module" style="left: 120px; top: 15px; width: 90px; height: 60px;">
          <div class="module-label">STUTTER</div>
          <div class="mini-knob-container">
            <div class="mini-knob" id="stutter-knob" data-param="stutter_intensity"></div>
          </div>
          <div class="module-jack input"></div>
          <div class="module-jack output"></div>
        </div>

        <!-- PITCH module -->
        <div class="effect-module" style="left: 230px; top: 15px; width: 90px; height: 60px;">
          <div class="module-label">PITCH</div>
          <div class="mini-knob-container">
            <div class="mini-knob" id="pitch-knob" data-param="pitch_shift"></div>
          </div>
          <div class="module-jack input"></div>
          <div class="module-jack output"></div>
        </div>

        <!-- SPEED module -->
        <div class="effect-module" style="left: 340px; top: 15px; width: 90px; height: 60px;">
          <div class="module-label">SPEED</div>
          <div class="mini-knob-container">
            <div class="mini-knob" id="speed-knob" data-param="speed"></div>
          </div>
          <div class="module-jack input"></div>
          <div class="module-jack output"></div>
        </div>

        <!-- REVERSE module -->
        <div class="effect-module" style="left: 450px; top: 15px; width: 90px; height: 60px;">
          <div class="module-label">REVERSE</div>
          <div class="mini-knob-container">
            <div class="mini-knob" id="reverse-knob" data-param="reverse_mix"></div>
          </div>
          <div class="module-jack input"></div>
          <div class="module-jack output"></div>
        </div>

        <!-- Global OUT jack -->
        <div class="global-jack" style="left: 590px; top: 30px;">
          <div class="jack-label">OUT</div>
          <div class="jack-backing">
            <div class="jack-housing">
              <div class="jack-contact"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- Modular cables SVG -->
      <svg id="cables-svg">
        <path id="cable-1" class="cable" stroke="#666666" d="M 61 95 Q 90 110, 130 75" />
        <path id="cable-2" class="cable" stroke="#8b4513" d="M 210 75 Q 220 90, 240 75" />
        <path id="cable-3" class="cable" stroke="#666666" d="M 320 75 Q 330 90, 350 75" />
        <path id="cable-4" class="cable" stroke="#8b4513" d="M 430 75 Q 440 90, 460 75" />
        <path id="cable-5" class="cable" stroke="#666666" d="M 540 75 Q 565 90, 606 95" />
      </svg>

      <!-- Hero Stutter Rate Knob -->
      <div class="hero-knob-container">
        <div class="hero-knob" id="hero-knob" data-param="stutter_rate">
          <!-- Scale markings -->
          <div class="knob-scale">
            <!-- We'll add scale marks via JavaScript -->
          </div>
        </div>
        <div class="hero-label">STUTTER RATE</div>
      </div>

      <!-- Bottom Controls -->

      <!-- Link toggle -->
      <div class="link-toggle" id="link-toggle" data-param="link_pitch_speed"></div>
      <div class="link-label">LINK P/S</div>

      <!-- Trigger mode selector -->
      <div class="trigger-selector" id="trigger-selector" data-param="trigger_mode">
        <span id="trigger-text">Always</span>
      </div>
      <div class="trigger-label">TRIGGER MODE</div>

      <!-- Threshold knob -->
      <div class="small-knob-container" style="left: 460px; top: 265px;">
        <div class="small-knob" id="threshold-knob" data-param="threshold"></div>
        <div class="small-label">THRESHOLD</div>
      </div>

      <!-- Mix knob -->
      <div class="small-knob-container" style="left: 550px; top: 265px;">
        <div class="small-knob" id="mix-knob" data-param="mix"></div>
        <div class="small-label">MIX</div>
      </div>
    </div>
  </div>

  <!-- Debug Monitor -->
  <div class="debug-monitor">
    <div class="debug-label">PARAMETER MONITOR</div>
    <div class="debug-param" id="debugParam">—</div>
    <div class="debug-value" id="debugValue">—</div>
    <div class="debug-normalized" id="debugNormalized">—</div>
  </div>

  <script>
    // Mock JUCE backend for browser testing
    window.Juce = {
      getSliderState: (id) => ({
        normalisedValue: 0.5,
        valueChangedEvent: {
          addListener: (fn) => console.log(`Listener added for ${id}`)
        }
      }),
      getToggleState: (id) => ({
        value: false,
        valueChangedEvent: {
          addListener: (fn) => console.log(`Listener added for ${id}`)
        }
      }),
      getComboBoxState: (id) => ({
        selectedId: 0,
        valueChangedEvent: {
          addListener: (fn) => console.log(`Listener added for ${id}`)
        }
      })
    };

    // Disable context menu (REQUIRED)
    document.addEventListener("contextmenu", (e) => {
      e.preventDefault();
      return false;
    });

    // Parameter definitions
    const parameters = {
      stutter_rate: { min: 0, max: 6, value: 3, choices: ["1/1", "1/2", "1/4", "1/8", "1/16", "1/32", "1/64"] },
      stutter_intensity: { min: 0, max: 1, value: 1 },
      pitch_shift: { min: -24, max: 24, value: 0, unit: "st" },
      speed: { min: 50, max: 200, value: 100, unit: "%" },
      reverse_mix: { min: 0, max: 100, value: 100, unit: "%" },
      link_pitch_speed: { value: false },
      trigger_mode: { value: 0, choices: ["Always", "MIDI", "Threshold"] },
      threshold: { min: -60, max: 0, value: -20, unit: "dB" },
      mix: { min: 0, max: 100, value: 100, unit: "%" }
    };

    // Update debug monitor
    function updateDebugMonitor(paramId, value, normalizedValue) {
      document.getElementById('debugParam').textContent = paramId;
      document.getElementById('debugValue').textContent = formatValue(paramId, value);
      document.getElementById('debugNormalized').textContent = `${(normalizedValue * 100).toFixed(1)}%`;
    }

    // Format parameter value
    function formatValue(paramId, value) {
      const param = parameters[paramId];
      if (param.choices) {
        return param.choices[Math.round(value)];
      }
      if (param.unit) {
        return `${value.toFixed(1)}${param.unit}`;
      }
      return value.toFixed(2);
    }

    // Rotary knob interaction
    function setupKnob(element, paramId) {
      const param = parameters[paramId];
      let isDragging = false;
      let startY = 0;
      let startValue = param.value;

      element.addEventListener('mousedown', (e) => {
        isDragging = true;
        startY = e.clientY;
        startValue = param.value;
        e.preventDefault();
      });

      document.addEventListener('mousemove', (e) => {
        if (!isDragging) return;

        const deltaY = startY - e.clientY;
        const sensitivity = param.choices ? 0.01 : 0.5;
        let newValue = startValue + (deltaY * sensitivity);

        // Clamp value
        newValue = Math.max(param.min, Math.min(param.max, newValue));
        param.value = newValue;

        // Update rotation
        const normalized = (newValue - param.min) / (param.max - param.min);
        const degrees = -135 + (normalized * 270);
        element.style.transform = `rotate(${degrees}deg)`;

        // Update debug monitor
        updateDebugMonitor(paramId, newValue, normalized);
      });

      document.addEventListener('mouseup', () => {
        isDragging = false;
      });

      // Initialize rotation
      const normalized = (param.value - param.min) / (param.max - param.min);
      const degrees = -135 + (normalized * 270);
      element.style.transform = `rotate(${degrees}deg)`;
    }

    // Toggle interaction
    function setupToggle(element, paramId) {
      const param = parameters[paramId];

      element.addEventListener('click', () => {
        param.value = !param.value;
        element.classList.toggle('active', param.value);
        updateDebugMonitor(paramId, param.value ? 1 : 0, param.value ? 1 : 0);
      });

      element.classList.toggle('active', param.value);
    }

    // Selector interaction
    function setupSelector(element, paramId) {
      const param = parameters[paramId];
      const textElement = element.querySelector('#trigger-text');

      element.addEventListener('click', () => {
        param.value = (param.value + 1) % param.choices.length;
        textElement.textContent = param.choices[param.value];
        const normalized = param.value / (param.choices.length - 1);
        updateDebugMonitor(paramId, param.value, normalized);
      });

      textElement.textContent = param.choices[param.value];
    }

    // Initialize controls
    document.addEventListener("DOMContentLoaded", () => {
      // Hero knob
      setupKnob(document.getElementById('hero-knob'), 'stutter_rate');

      // Mini knobs
      setupKnob(document.getElementById('stutter-knob'), 'stutter_intensity');
      setupKnob(document.getElementById('pitch-knob'), 'pitch_shift');
      setupKnob(document.getElementById('speed-knob'), 'speed');
      setupKnob(document.getElementById('reverse-knob'), 'reverse_mix');

      // Small knobs
      setupKnob(document.getElementById('threshold-knob'), 'threshold');
      setupKnob(document.getElementById('mix-knob'), 'mix');

      // Toggle
      setupToggle(document.getElementById('link-toggle'), 'link_pitch_speed');

      // Selector
      setupSelector(document.getElementById('trigger-selector'), 'trigger_mode');

      // Add scale markings around hero knob
      const scaleContainer = document.querySelector('.knob-scale');
      const divisions = ['1/1', '1/2', '1/4', '1/8', '1/16', '1/32', '1/64'];
      divisions.forEach((label, i) => {
        const angle = -135 + (i / (divisions.length - 1)) * 270;
        const radians = (angle - 90) * Math.PI / 180;
        const radius = 75;
        const x = 75 + Math.cos(radians) * radius;
        const y = 75 + Math.sin(radians) * radius;

        const textEl = document.createElement('div');
        textEl.className = 'scale-text';
        textEl.textContent = label;
        textEl.style.left = `${x}px`;
        textEl.style.top = `${y}px`;
        textEl.style.transform = `translate(-50%, -50%)`;
        scaleContainer.appendChild(textEl);
      });

      console.log('ChopShop v3 UI initialized - Industrial Decay aesthetic');
    });
  </script>
</body>
</html>
