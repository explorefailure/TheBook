---
plugin: ChopShop
stage: 3
phase: null
status: complete
last_updated: 2025-12-09
complexity_score: 5.0
phased_implementation: true
orchestration_mode: true
next_action: begin_validation
next_phase: null
latest_mockup_version: 1
mockup_finalized: false
contract_checksums:
  creative_brief: sha256:b489a30a1f2c34eb9de99599c439d5b88262e8f2f9418da8b6a10a94aa4ae2ee
  parameter_spec: sha256:df3c99f8b641773e89d3e410f505e58011e24e347fe56addb379b989aed19e3d
  architecture: sha256:cf61c414e1427f416c0594c364bdc16b1cd3c348da53c1b8ce2c3a31c49428bc
  plan: sha256:ccc5b23f8c5bb1a3252e58638efaec5804b0809ae64de5751131e3ebdef81702
---

# Resume Point

## Current State: Stage 3 Complete - Headless GUI Implemented

All DSP processing complete. Native JUCE GUI implemented with 8 parameter controls. Plugin ready for build validation and testing.

## Completed So Far

**Ideation:** ✓ Complete
- Core concept defined (precision stutter-glitch processor)
- Parameters specified (8 main parameters)
- Effect chain architecture (reorderable: stutter/pitch/speed/reverse)
- Trigger modes defined (always-on, MIDI, threshold)
- Use cases identified (drums, breakbeats, one-shots)
- Inspirations captured (Venetian Snares, Aphex Twin, dBlue Glitch)

**UI Mockup v1:** ✓ Complete
- Aesthetic: "Junkyard Wars meets The Jetsons"
- 650x300px wide horizontal layout
- Weathered metal with patina green finish
- Atomic age colors (turquoise, orange) + copper/brass accents
- Early 1900s bakelite-era knobs
- Modular patch-bay cable visualization
- All WebView constraints validated
- Interactive browser test created

**Stage 0 (Research & Planning):** ✓ Complete
- Plugin type defined: Audio Effect (Stutter/Glitch)
- Professional examples researched: 4 (dBlue Glitch 2, Effectrix 2, Stutter Edit 2, DFX Buffer Override)
- JUCE modules identified: juce::AudioPlayHead, juce::MidiBuffer, juce::dsp::DryWetMixer, custom implementations
- DSP feasibility verified: Granular synthesis for pitch/speed, dual envelope follower for transient detection
- Parameter ranges researched: 8 parameters defined
- Complexity score: 5.0 (COMPLEX - phased implementation required)
- Strategy: Phase-based implementation (3 DSP phases, 2 GUI phases)
- Architecture documented: plugins/ChopShop/.ideas/architecture.md
- Plan documented: plugins/ChopShop/.ideas/plan.md
- Total estimated time: 13.5-15.5 hours

**Stage 1 (Foundation + Shell):** ✓ Complete
- Build system configured (CMakeLists.txt with JUCE 8 patterns)
- NEEDS_MIDI_INPUT TRUE for MIDI trigger mode
- 8 APVTS parameters implemented (stutterRate, pitchShift, speed, linkPitchSpeed, reverse, triggerMode, threshold, mix)
- chainOrder stored in ValueTree (custom state)
- State management implemented (save/load with custom state)
- Pass-through audio processing (DSP implementation deferred to Stage 2)
- Files created: CMakeLists.txt, PluginProcessor.h/cpp, PluginEditor.h/cpp, PluginIDs.h

**Stage 2 Phase 2.1 (Core Stutter Processing):** ✓ Complete
- Circular buffer implemented (juce::AudioBuffer<float>)
- Buffer size: 4 bars at 40 BPM @ 192kHz (~1.8MB worst case)
- Tempo sync via AudioPlayHead (fallback to 120 BPM)
- Stutter rate divisions: 1/1 to 1/64 (7 note divisions)
- Buffer capture and repeat with 5ms crossfade at loop boundaries
- Dry/wet mixer (juce::dsp::DryWetMixer<float>) with latency compensation
- Trigger mode: Always (continuous stutter)
- Real-time safety: All allocations in prepareToPlay(), no allocations in processBlock()
- Files modified: PluginProcessor.h/cpp

**Stage 2 Phase 2.2 (Trigger Modes and Reverse):** ✓ Complete
- MIDI trigger mode: Note-on messages trigger stutter capture
- Threshold trigger mode: Dual envelope follower transient detection
  - Fast envelope: 1ms attack, 10ms release
  - Slow envelope: 50ms attack, 200ms release
  - Threshold parameter: -60dB to 0dB sensitivity
  - 3dB hysteresis to prevent re-triggering
- Reverse processing: Buffer playback reverses when enabled
- Trigger modes mutually exclusive (Always/MIDI/Threshold)
- All trigger parameters connected to DSP
- Files modified: PluginProcessor.h/cpp

**Stage 2 Phase 2.3 (Pitch Shift, Speed, Effect Chain):** ✓ Complete
- Pitch shift engine: Simple resampling with linear interpolation
  - Range: -24 to +24 semitones
  - Uses varispeed approach (linked mode)
- Speed manipulation: Integrated with pitch shift
  - Range: 50% to 200%
  - Linked mode: Pitch changes with speed (tape-style)
  - Independent mode: Pitch shift only (speed parameter reserved for future time-stretching)
- Reorderable effect chain:
  - Effect indices: 0=Stutter, 1=Pitch, 2=Speed, 3=Reverse
  - Default order: "0,1,2,3"
  - Chain order parsed from ValueTree customState
  - Effects applied in sequence via switch/case
- Intermediate process buffer allocated in prepareToPlay()
- All processing real-time safe (no allocations in processBlock)
- Files modified: PluginProcessor.h/cpp

**Stage 3 (Headless GUI):** ✓ Complete
- Native JUCE component-based UI (no WebView)
- 8 parameter controls implemented:
  - ComboBox: stutterRate (1/1 to 1/64)
  - Slider: pitchShift (-24 to +24 st)
  - Slider: speed (50 to 200%)
  - ToggleButton: linkPitchSpeed
  - ToggleButton: reverse
  - ComboBox: triggerMode (Always/MIDI/Threshold)
  - Slider: threshold (-60 to 0 dB)
  - Slider: mix (0 to 100%)
- All parameters bound via AudioProcessorValueTreeState attachments
- Simple vertical layout with labels
- 600x400 window size
- Files modified: PluginEditor.h, PluginEditor.cpp

## Next Steps

1. **Validation:** Build and test plugin
   - Compile plugin with cmake/xcodebuild
   - Run pluginval validation
   - Test in DAW (automation, presets, trigger modes)
2. **Optional Enhancements:**
   - WebView UI with retro-futuristic aesthetic (mockup v1 available)
   - Chain order visual interface (drag-and-drop cables)
   - Preset browser
3. **Documentation:** Update CHANGELOG.md with feature list

## Context to Preserve

**Key Decisions:**
- Plugin type: Audio Effect (Stutter/Glitch)
- Core concept: Controlled chaos - maximum capability with precision control
- Target use: Drums and one-shot samples
- Stutter rate: Single knob sweeping 1/1 to 1/64 divisions
- Pitch/Speed: Independent controls with link option
- Effect chain: User-reorderable signal flow
- Trigger modes: Always-on / MIDI / Transient threshold

**Design Aesthetic:**
- Retro-futuristic junkyard (Junkyard Wars + The Jetsons)
- Weathered metal, patina greens, copper/brass hardware
- Atomic age accents (turquoise #5bc0be, orange #ff6b35)
- Bakelite-era knobs with brass indicators
- Exposed rivets, googie curves
- Modular patch-bay style effect chain

**Files Created:**
- plugins/ChopShop/.ideas/creative-brief.md
- plugins/ChopShop/.ideas/mockups/v1-ui.yaml
- plugins/ChopShop/.ideas/mockups/v1-ui-test.html
- plugins/ChopShop/.ideas/architecture.md
- plugins/ChopShop/.ideas/plan.md

**Research References:**
- dBlue Glitch 2 (illformed) - Classic stutter/glitch plugin
- Effectrix 2 (Sugar Bytes) - Step-sequenced multi-effect
- Stutter Edit 2 (iZotope/BT) - MIDI-triggered gesture stutter
- DFX Buffer Override (Destroy FX) - Buffer-based stutter

**Architecture Highlights:**
- 5 complex DSP components: Stutter engine, pitch shift, speed/time-stretch, transient detection, reorderable chain
- Granular synthesis for pitch shifting (MEDIUM complexity, acceptable artifacts for glitch effect)
- Dual envelope follower for threshold-independent transient detection
- Reorderable effect chain with string parameter (chainOrder)
- Three trigger modes: Always, MIDI, Threshold
- Linked/independent pitch/speed modes (tape-style vs professional)

**Implementation Risks:**
- Pitch shifting is highest risk (50% of project risk) - granular artifacts, CPU usage
- Tempo sync reliability varies by host - requires BPM fallback
- Reorderable chain has 24 possible permutations - test thoroughly
- Buffer allocation: ~1.8MB worst case (4 bars at 40 BPM @ 192kHz)
